{% extends "main1/home.html" %} {% load static %} {% block content %}
<style>
  :root {
    --primary-color: #1DB954;
    --secondary-color: #191414;
    --text-color: #FFFFFF;
    --background-color: #FFFFFF;
    --accent-color: #1ED760;
  }

  body {
    background-color: var(--background-color);
    color: var(--text-color);
    font-family: 'Circular', Arial, sans-serif;
  }

  #artist-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  #artist-header {
    text-align: center;
    margin-bottom: 30px;
  }

  #artist-name {
    font-size: 3em;
    color: var(--primary-color);
  }

  #artist-price {
    font-size: 2em;
    font-weight: bold;
  }

  #artist-change {
    font-size: 1.2em;
    color: var(--accent-color);
  }

  #content-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
  }

  #graph-container {
    width: 65%;
    background-color: var(--secondary-color);
    border-radius: 10px;
    padding: 20px;
  }

  #order-container {
    width: 30%;
    background-color: var(--secondary-color);
    border-radius: 10px;
    padding: 20px;
  }

  .order-form {
    display: flex;
    flex-direction: column;
  }

  .form-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }

  .form-group {
    width: 48%;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    color: var(--text-color);
  }

  .form-group select,
  .form-group input {
    width: 100%;
    padding: 8px;
    border: none;
    border-radius: 4px;
    background-color: var(--background-color);
    color: var(--text-color);
  }

  .btn-primary {
    background-color: var(--primary-color);
    color: var(--text-color);
    border: none;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .btn-primary:hover {
    background-color: var(--accent-color);
  }

  #metadata-container {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
  }

  .metadata-item {
    width: 22%;
    background-color: var(--secondary-color);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    text-align: center;
  }

  .metadata-item h3 {
    color: var(--primary-color);
    margin-bottom: 10px;
  }
</style>

<div id="spotify-brand">
</div>

<div id="artist-page">
  <div id="artist-header">
    <h1 id="artist-name">{{ artist }}</h1>
    <div id="artist-price">${{ stock_data.current_price|floatformat:2 }}</div>
    <div id="artist-change" {% if stock_data.price_change >= 0 %}style="color: #27ae60;"{% else %}style="color: #e74c3c;"{% endif %}>
      ${{ stock_data.price_change|floatformat:2 }} ({{ stock_data.percent_change|floatformat:2 }}%)
    </div>
  </div>

  <div id="content-container">
    <div id="graph-container">
      <!-- Placeholder for the graph -->
    </div>

    <div id="order-container">
      <h2>Place an Order</h2>
      <form action="{% url 'artist_detail' artist %}" method="POST" class="order-form">
        {% csrf_token %}
        
        <div class="form-row">
          <div class="form-group">
            <label for="{{ form.buysell.id_for_label }}">Order Type:</label>
            {{ form.buysell }}
          </div>
          <div class="form-group">
            <label for="{{ form.type.id_for_label }}">Order Method:</label>
            {{ form.type }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="{{ form.limit_price.id_for_label }}">Limit Price:</label>
            {{ form.limit_price }}
          </div>
          <div class="form-group">
            <label for="{{ form.num_shares.id_for_label }}">Number of Shares:</label>
            {{ form.num_shares }}
          </div>
        </div>

        <div class="form-row">
          <button type="submit" class="btn btn-primary">Place Order</button>
        </div>
      </form>
    </div>
  </div>

  <div id="metadata-container">
    <div class="metadata-item">
      <h3>Market Cap</h3>
      <p id="market-cap"></p>
    </div>
    <div class="metadata-item">
      <h3>52 Week High</h3>
      <p id="fifty-two-week-high"></p>
    </div>
    <div class="metadata-item">
      <h3>52 Week Low</h3>
      <p id="fifty-two-week-low"></p>
    </div>
    <div class="metadata-item">
      <h3>P/E Ratio</h3>
      <p id="pe-ratio"></p>
    </div>
  </div>

  <div id="artist-bio">
    <h2>Artist Biography</h2>
    <div id="bio-content"></div>
  </div>


  <div id="artist-metadata">
    <h2>Artist Details</h2>
    <div class="metadata-grid">
      <div class="metadata-item artist-image">
        <img id="artist-picture" src="" alt="{{ artist }} picture">
      </div>
      <div class="metadata-item artist-details">
        <h3>Spotify Followers</h3>
        <p id="followers"></p>
        <h3>Genres</h3>
        <div id="genres" class="genre-tags"></div>
      </div>
    </div>
    <div class="top-tracks">
      <h3>Top Tracks</h3>
      <ol id="top-tracks-list"></ol>
    </div>
  </div>
</div>

<style>
  #artist-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #333;
    background-color: #f8f9fa;
  }
  #artist-header {
    text-align: center;
    margin-bottom: 30px;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #artist-name {
    font-size: 2.5em;
    margin-bottom: 10px;
    color: #2c3e50;
  }
  #artist-price {
    font-size: 2em;
    font-weight: bold;
    color: #27ae60;
  }
  #artist-change {
    font-size: 1.2em;
    color: #27ae60;
  }
  #content-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
  }
  #graph-container {
    width: 65%;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #price-graph {
    width: 100%;
    height: auto;
  }
  #order-container {
    width: 30%;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .order-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .form-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
  }
  .form-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .form-group label {
    margin-bottom: 5px;
    font-weight: bold;
    color: #2c3e50;
  }
  .form-group input,
  .form-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid #bdc3c7;
    border-radius: 4px;
    font-size: 14px;
  }
  .btn-primary {
    background-color: #3498db;
    border: none;
    color: white;
    padding: 10px 20px;
    cursor: pointer;
    width: 100%;
    border-radius: 4px;
    transition: background-color 0.3s;
    font-size: 16px;
    font-weight: bold;
  }
  .btn-primary:hover {
    background-color: #2980b9;
  }
  #metadata-container {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-bottom: 30px;
  }
  .metadata-item {
    width: 22%;
    text-align: center;
    margin-bottom: 20px;
    background-color: #ffffff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .metadata-item h3 {
    font-size: 1em;
    margin-bottom: 5px;
    color: #7f8c8d;
  }
  .metadata-item p {
    font-size: 1.2em;
    font-weight: bold;
    color: #2c3e50;
  }
  #artist-bio {
    margin-top: 30px;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #artist-bio h2 {
    font-size: 1.5em;
    margin-bottom: 15px;
    color: #2c3e50;
  }
  #bio-content {
    line-height: 1.6;
    color: #34495e;
  }

  #artist-metadata {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-top: 30px;
  }

  .metadata-grid {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .metadata-item {
    width: 48%;
  }

  .artist-image {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 30%; /* Reduced from 48% to 30% */
  }

  #artist-picture {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    max-height: 200px; /* Added max-height to limit the size */
    object-fit: cover; /* Ensures the image covers the area without stretching */
  }

  .artist-details {
    width: 65%; /* Increased from 48% to 65% */
  }

  .genre-tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
  }

  .genre-tag {
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    color: #ffffff;
    background-color: #1DB954;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .genre-tag:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
  }

  .top-tracks ol {
    columns: 2;
    -webkit-columns: 2;
    -moz-columns: 2;
  }

  .top-tracks li {
    margin-bottom: 10px;
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var artist = "{{ artist }}";
    
    // Fetch artist bio
    fetch(`/api/artist_bio/?query=${encodeURIComponent(artist)}`)
      .then(response => response.json())
      .then(data => {
        document.getElementById('bio-content').textContent = data.bio;
      })
      .catch(error => {
        console.error('Error fetching artist biography:', error);
        document.getElementById('bio-content').textContent = 'Failed to load artist biography.';
      });

    // Fetch artist metadata
    fetch(`/api/artist_metadata/?query=${encodeURIComponent(artist)}`)
      .then(response => response.json())
      .then(data => {
        const artistData = data.artists_data;
        
        // Update artist picture
        document.getElementById('artist-picture').src = artistData.pictures;
        
        // Update followers
        document.getElementById('followers').textContent = artistData.followers.toLocaleString();
        
        // Update genres
        const genresContainer = document.getElementById('genres');
        artistData.genres.forEach((genre, index) => {
          const genreTag = document.createElement('span');
          genreTag.className = 'genre-tag';
          genreTag.textContent = genre;
          genreTag.style.backgroundColor = getRandomColor();
          genresContainer.appendChild(genreTag);
        });
        
        // Update top tracks
        const topTracksList = document.getElementById('top-tracks-list');
        artistData.top_tracks.forEach((track, index) => {
          const li = document.createElement('li');
          li.textContent = `${track} (${artistData.track_popularity[index]})`;
          topTracksList.appendChild(li);
        });
      })
      .catch(error => {
        console.error('Error fetching artist metadata:', error);
        document.getElementById('artist-metadata').textContent = 'Failed to load artist metadata.';
      });
  });

  function getRandomColor() {
    const hue = Math.floor(Math.random() * 360);
    return `hsl(${hue}, 70%, 50%)`;
  }


  fetch('/api/artist_stock/')
    .then(response => response.json())
    .then(data => {
      const stockData = data.stock;
      document.getElementById('artist-price').textContent = `$${stockData.current_price.toFixed(2)}`;
      document.getElementById('artist-change').textContent = 1
      
      // Update metadata container
      document.getElementById('market-cap').textContent = `$${(stockData.market_cap / 1e9).toFixed(2)} Billion`;
      document.getElementById('fifty-two-week-high').textContent = `$${stockData.fifty_two_week_high.toFixed(2)}`;
      document.getElementById('fifty-two-week-low').textContent = `$${stockData.fifty_two_week_low.toFixed(2)}`;
      document.getElementById('pe-ratio').textContent = stockData.pe_ratio ? stockData.pe_ratio.toFixed(2) : 'N/A';
    })
    .catch(error => {
      console.error('Error fetching Apple stock data:', error);
    });
</script>

{% endblock %}